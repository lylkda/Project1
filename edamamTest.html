<!DOCTYPE html>
<html>
<head>
	<title>Edamam Test</title>
</head>
<body>
	<h1>Edamam Test!</h1>
	<form id="foodQuery">
		<label for="food">Add a food!</label><br>
		<input type="text" id="foodInput"><br>
		<input type="submit" id="searchFood" value="I AM STILL HANGRY!">
		<button id="saveItem">
			Share This Recipe
		</button>
	</form>
	<form id="ingQuery">
		<label for="ingredient">Learn more about an ingredient!</label><br>
		<input type="text" id="ingInput"><br>
		<input type="submit" id="searchIng" value="TELL ME ABOUT THE THING">
	</form>
	
	<div id="dataDump">
	</div>

	<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
	<script>
  		// Initialize Firebase
  		var config = {
  			apiKey: "AIzaSyDlsaT02twkrDLQHh6V7kwVGQS4PJ1SxUA",
  			authDomain: "myintrotodatabases.firebaseapp.com",
  			databaseURL: "https://myintrotodatabases.firebaseio.com",
  			projectId: "myintrotodatabases",
  			storageBucket: "myintrotodatabases.appspot.com",
  			messagingSenderId: "834216684806"
  		};
  		firebase.initializeApp(config);

  		var database = firebase.database();
  	</script>

  	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  	<script type="text/javascript">

  		$("#searchFood").on("click", function() {
  			event.preventDefault();

  			var foodSearch = $("#foodInput").val().trim();
  			console.log(foodSearch);
  			var queryURL = "https://api.edamam.com/search?app_id=6891053a&app_key=850e0cd22232d2c3a43600cea1277a5f&q=" + foodSearch + "&from=0&to=100"

  			$.ajax({
  				url: queryURL,
  				method: "GET"
  			}).done(function(response) {

  				console.log(response);

  				var results = response.hits;

					// if statement for count=0, meaning no recipes were found
					if (response.count === 0) {
						//modal placeholder
					}
					
					var randomStart = Math.floor(Math.random()*100);
					console.log(randomStart);
					var i = randomStart;

					
					var recipeName = results[i].recipe.label;
					var recipePic = results[i].recipe.image;
					var recipeDirections = results[i].recipe.url;
					var recipeIngredients = results[i].recipe.ingredientLines;
					var totalIngredients = recipeIngredients.length;
					var recipeDiv = $("<div class='newItem' style='border-style:double;'>");

					var displayImg = $("<img>");
					displayImg.attr("src", recipePic);
					var titleP = $("<p>").html("<h2>Recipe Name: " + recipeName + "<br>");
					var ingredientDetails = $("<p>").html("Contains: " + totalIngredients + " ingredients");

					for ( i = 0; i < recipeIngredients.length; i++) {
						var ingredientList = $("<ul />")
						var singleItem = $("<li />").text(recipeIngredients[i]);
						ingredientList.append(singleItem);

						console.log(ingredientList)
						recipeDiv.prepend(ingredientList);
					}
					
					recipeDiv.prepend(ingredientDetails);
					recipeDiv.prepend(recipeDirections);
					recipeDiv.prepend(displayImg);
					recipeDiv.prepend(titleP);

					$("#dataDump").empty();

					$("#dataDump").prepend(recipeDiv);

					$("#saveItem").on('click', function() {
						event.preventDefault();

						database.ref().push({
							favoritedRecipe: recipeName,
							favoritedImg: recipePic,
							favoritedDirections: recipeDirections,
							favoritedIng: totalIngredients,
							favoritedIngList: recipeIngredients
						});
						database.ref().on("value", function(snapshot){
							console.log(snapshot.val());
						})
					});					
				})
			}); //ends submit button on click function


		</script>

	</body>
	</html>